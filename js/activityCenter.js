function resetCss(){var t=Math.ceil($(".discountBox").width()/19);$(".discountBox").each(function(){$(this).hasClass("complete")||($(this).width(19*t),$(this).find(".intro").dotdotdot(),$(this).addClass("complete"))})}$(function(){function t(t,e){$.ajax({url:r+"/wpwl/getKey",type:"post",success:function(n){C=n.data,t=1==u.type?t||"disCountContent":t||"disActContent",p&&1==u.type&&($(".act_title .current").removeClass("current"),$(".act_title div").eq(1).addClass("current"),$("#discountContent").addClass("current"),$(".dis_act_content").removeClass("current")),i(t,e)}})}function e(t,e){clearInterval(f),p||WPBridge.callMethod("JsInvokeNative","wpShowLoadingDialog",{a:1},function(){}),WPBridge.callMethod("JsInvokeNative","wpEncrypt",{key:C,params:t},function(t){clearInterval(f),e&&e(t)}),f=setInterval(function(){WPBridge.callMethod("JsInvokeNative","wpEncrypt",{key:C,params:t},function(t){clearInterval(f),e&&e(t)})},30)}function n(t){var e="";switch(t){case"dis_act_content":e="disActContent";break;case"discountContent":e="disCountContent";break;case"undiscountContent":e="undisCountContent"}return e}function o(t){var e={url:"",obj:"",layHTML:"",rebatesType:0};switch(t){case"disActContent":e={url:"/wpwl/activity/getSuspectActivityListByPage",obj:$("#dis_act_content"),layHTML:$("#rebate_activity").html(),rebatesType:""};break;case"disCountContent":e={url:"/wpwl/activityDiscount/listRebateByPage",obj:$("#discountContent"),layHTML:$("#rebate_vouchers").html(),rebatesType:1};break;case"undisCountContent":e={url:"/wpwl/activityDiscount/listRebateByPage",obj:$("#undiscountContent"),layHTML:$("#rebate_vouchers").html(),rebatesType:0}}return e}function i(t,n){var i=u.suspectId,a=o(t);m=a.url,n&&(m=a.url),w=a.obj,g=a.layHTML,v&&(v=!1,e([i,d[t],h,a.rebatesType],function(e){s(t,e,n)}))}function a(t){var e="",n="";"disActContent"==t?(e="您未参加过活动，您可以：返回“首页”<br>点击“附近门店”查找并参加活动",n="images/no_active.png"):(e="您未获取返利券",n="images/no_rebate.png"),$(".content").show(),$(".dis_content.current").removeClass(".current"),$("#share").hide(),$(".loading").show(),n==$(".loadEffect img").attr(n)?$(".loadEffect").hide().siblings(".middle").show():$(".loadEffect").hide().siblings(".middle").show().find("img").attr("src",n).siblings("p").html(e)}function s(e,n,o){var i=n.data.result,s={suspectId:i[0],pageIndex:i[1],pageSize:i[2]};"disActContent"!==e&&(s.rebatesType=i[3]),$.ajax({url:r+m,type:"post",data:s,timeout:1e4,success:function(n){ajaxComplete(n,function(){o||t(e,!0)},function(){$(".loading").hide();var t=n.data,o=null;if($(".content").show(),$(".err_text").hide(),$("#share").show(),d[e]==Math.ceil(t.total/h)&&w.addClass("complete"),d[e]+=1,t.list){o=t.list;for(i=0;i<o.length;i++)o[i].gmtStart=o[i].gmtStart.replace(/-/g,"."),o[i].gmtEnd=o[i].gmtEnd.replace(/-/g,".")}else{o=t.rebates;for(var i=0;i<o.length;i++)o[i].couponUserPhone=encryptyPhone(o[i].couponUserPhone),o[i].receiveStartTime=o[i].receiveStartTime.replace(/-/g,"."),o[i].receiveEndTime=o[i].receiveEndTime.replace(/-/g,"."),"disCountContent"==e&&(o[i].status=2)}o.length?laytpl(g).render(o,function(t){w.append(t),resetCss(),imgError(),"disCountContent"==e?$(".look").removeClass("unshow"):$(".look").addClass("unshow")}):a(e)},function(){a(e)}),v=!0,p&&(wpCommon.viewShow(),p=!1)},error:function(t,e,n){ajaxError()},complete:function(){v=!0,p||WPBridge.callMethod("JsInvokeNative","wpDismissLoadingDialog",{a:1},function(){})}})}function c(t){var e=t.attr("content"),o=$("#"+e);$(".dis_content.current").removeClass("current"),$(".err_text").hide(),o.addClass("current"),o.html().trim()?($(".loading").hide(),"discountContent"==e?$(".look").removeClass("unshow"):$(".look").addClass("unshow")):(v=!0,i(n(e))),$(window).scrollTop(0)}var r=wpCommon.Url,l=null,d={disActContent:1,disCountContent:1,unActContent:1,undisCountContent:1},u=getUrlRequest(),h=6,v=!0,C=null,p=!0;t();var f=null,m="",w="",g="";$(window).on("scroll",function(){var t=$(this).scrollTop();clearTimeout(l),l=setTimeout(function(){t+$(window).height()>$(".dis_content.current").height()+$(".dis_content.current").offset().top-200&&$(".dis_content").each(function(){var t=$(this);if(t.hasClass("current"))return t.hasClass("complete")||i(n(t.attr("id"))),!1})},300)}),$(".act_title div").on("click",function(){var t=$(this);t.hasClass("current")||($(".act_title .current").removeClass("current"),t.addClass("current"),c(t)),"discountContent"==t.attr("content")&&WPBridge.callMethod("JsInvokeNative","wpHitDotEvent",{eventId:"h5_e083"},function(){})});var y=!1;$(".more").click(function(){var t=$(this);$(".look").addClass("unshow"),$(".act_title").hide(),c(t),$(".top div").html("失效返利"),y=!0});var _=null;$("#back").on("click",function(){clearInterval(_),y?_=setInterval(function(){v&&(clearInterval(_),y=!1,$(".dis_content").each(function(){var t=$(this);if(t.hasClass("current")){t.attr("id");return $(".look").removeClass("unshow"),$(".act_title").show(),$(".top div").html("活动中心"),c($(".act_title .current")),!1}}))},30):WPBridge.callMethod("JsInvokeNative","wpH5Back",{},"")}),$("#wpReload").click(function(){v=!0,d={disActContent:1,disCountContent:1,unActContent:1,undisCountContent:1},$(".dis_content.current").removeClass("current"),$("#disActContent").html("").addClass("current").removeClass("complete"),$(".look .more").attr("content","un_act_content"),s("disActContent")}),$("body").on("click",".activity_list",function(){var t=$(this),e=u.suspectId,n=t.attr("aid");WPBridge.callMethod("JsInvokeNative","wpHitDotEvent",{eventId:"h5_e080",otherId:n},function(){}),window.location.href="eventDetails.html?pageId=H5_C013&otherId="+n+"&posId="+t.attr("pid")+"&activityId="+n+"&suspectId="+e}),$("body").on("click",".discountBox",function(){var t=$(this),e=t.attr("aid");t.find(".icons").hide(),WPBridge.callMethod("JsInvokeNative","wpHitDotEvent",{eventId:"h5_e081",otherId:e},function(){}),window.location.href="discountDetail.html?pageId=H5_C016&otherId="+e+"&rebateId="+t.attr("pid")})});