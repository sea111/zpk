$(function(){function e(e){$.ajax({url:wpCommon.Url+"/wpwl/getKey",type:"post",success:function(i){key=i.data,t(e)}})}function t(t){WPBridge.callMethod("JsInvokeNative","wpEncrypt",{key:key,params:[n]},function(n){$.ajax({url:wpCommon.Url+"/wpwl/afterservice/"+t,data:{versionId:"27",suspectId:n.data.result[0]},type:"post",timeout:1e4,success:function(n){if(""==n.data.list&&($("#application-content").hide(),$("#schedule-content").hide(),$(".middle img").attr("src","images/emptys.png"),$(".middle p").html("暂无售后消息"),$(".loading").show(),$(".loading").css({zIndex:"1",height:"93%"})),"AES加密解密失败"==n.errMsg)keyFlag||(e(t,params),keyFlag=!0);else if(0==n.success)$(".application-schedule").hide(),$("#application-content").hide(),$("#schedule-content").hide(),$(".loading").show(),$(".middle img").attr("src","images/error_else.png"),$(".middle p").html("出错了，请稍后再试"),$(".top div").html("异常页面");else{try{if(n.success)if(i=n.data.list,o=i.length,a)for(var l=$("#schedule-content"),d=0;d<i.length;d++){var c=$(".schedule-list").eq(0).clone();"2"==i[d].orderStatus?(c.find(".evaluate").hide(),c.find(".finish").html("已评价")):"1"==i[d].orderStatus&&(c.find(".evaluate").show(),c.find(".finish").html("已完成")),"0"==i[d].readStatus?c.find(".red").show():"1"==i[d].readStatus&&c.find(".red").hide(),c.addClass("schedule-item").find(".work").html(i[d].workOrder),c.find(".time").html(i[d].gmtCreate),c.find("img.icon-url").attr("src",i[d].iconURL),c.find(".schedule-name").html(i[d].name).siblings(".schedule-model").html(i[d].standard),c.show(),l.append(c)}else for(var l=$("#application-content"),d=0;d<i.length;d++)(c=$(".application-list").eq(0).clone()).find(".icon-url").attr("src",i[d].iconURL),c.find(".application-right").attr("tel",i[d].serviceTel),c.find(".title").html(i[d].name).siblings(".model").html(i[d].standard),c.show(),l.append(c)}catch(e){$(".application-schedule").hide(),$("#application-content").hide(),$("#schedule-content").hide(),$(".loading").show(),$(".middle img").attr("src","images/error_else.png"),$(".middle p").html("出错了，请稍后再试"),$(".top div").html("异常页面")}wpCommon.viewShow()}},error:function(e,t,i){"timeout"==t&&($(".application-schedule").hide(),$("#application-content").hide(),$("#schedule-content").hide(),$(".loading").show(),$(".top div").html("网络异常")),wpCommon.viewShow()}})})}WPBridge.callMethod("JsInvokeNative","wpShowLoadingDialog",{},function(){});var i,o,n=getUrlRequest().suspectId,a=0;$(".after-application").click(function(){a=0,$(this).css({color:"#fff",background:"#d6a41d","border-bottom":"1px solid #d6a41d"}),$(".aftermarket-schedule").css({color:"#343434",background:"#fff","border-bottom":"1px solid #ccc"}),$("#application-content").show(),$("#schedule-content").hide()}),$(".aftermarket-schedule").click(function(){a=1,WPBridge.callMethod("JsInvokeNative","wpShowLoadingDialog",{},function(){}),$(this).css({color:"#fff",background:"#d6a41d","border-bottom":"1px solid #d6a41d"}),$(".after-application").css({color:"#343434",background:"#fff","border-bottom":"1px solid #ccc"}),$("#schedule-content").show(),$("#application-content").hide(),this.flag||(t("listprogression"),this.flag=!0),wpCommon.viewShow()}),e("listapplication"),$("#back").click(function(){WPBridge.callMethod("JsInvokeNative","wpH5Back",{},"")}),$(document).on("click",".application-right",function(){WPBridge.callMethod("JsInvokeNative","wpUpCallTel",{tel:$(this).attr("tel")},"")}),$("#wpReload").click(function(){t(portUrl)}),$(document).on("touchstart",".evaluate",function(){var e=$(this).parent().parent().parent(".schedule-list").index()-1;localStorage.setItem("serviceDetail",JSON.stringify(i[e])),WPBridge.callMethod("JsInvokeNative","wpHitDotEvent",{eventId:"h5_e091",otherId:""},""),window.location.href="evaluation.html?pageId=H5_C026&suspectId="+n}),$(document).on("touchstart",".see-details",function(){var e=$(this).parent().parent().parent(".schedule-list").index()-1;$(this).find(".red").hide(),localStorage.setItem("serviceDetail",JSON.stringify(i[e])),WPBridge.callMethod("JsInvokeNative","wpHitDotEvent",{eventId:"h5_e092",otherId:""},""),window.location.href="afterSaleDetail.html?pageId=H5_C025&suspectId="+n}),window.onResume=function(){WPBridge.callMethod("JsInvokeNative","wpShowLoadingDialog",{},""),a=1,$(".schedule-item").remove(),t("listprogression")}});