$(function(){function e(e){$.ajax({url:n+"/wpservice/getKey?clientType=5",type:"POST",success:function(t){e&&e(t.data),console.log(t.data)}})}function t(e,t){var r=base64decode(t),o=CryptoJS.enc.Utf8.parse(r);return CryptoJS.AES.encrypt(e,o,{mode:CryptoJS.mode.ECB,padding:CryptoJS.pad.Pkcs7}).toString()}function r(e){window.labelCode=d.toString(),$.ajax({type:"POST",url:n+"/wpwl/saleRecord/getById",timeout:1e4,data:{serialNo:t(labelCode,e),versionId:27},success:function(e){if(0==e.success)$(".picture").hide(),$(".background").hide(),$("#consumer-content").hide(),$(".footer").hide(),$("body").css("background","#F8F8F8"),$(".loadEffect").hide().siblings(".middle").show(),$(".middle img").attr("src","images/vrf_wrong.png"),$(".middle p").html("请先扫描商品上的防伪标签再进行相应的登记操作哟!"),$(".loading").show();else try{if(e.success){var t=e.data;window.isSold=t.isSold;var r=t.productUrl,o=t.brandName,i=t.standard,s=t.productName;window.orgId=t.orgId,84==orgId?"yes"==isSold?($(".picture").hide(),$(".consumer-agency").hide(),$(".background").hide(),$("#consumer-content").hide(),$(".commodity-status").hide(),$(".footer").hide(),$("body").css("background","#F8F8F8"),$(".loadEffect").hide().siblings(".middle").show(),$(".middle img").attr("src","images/commodityRepetition.png"),$(".middle p").html("该商品已登记，请勿重复操作"),$(".loading").show()):$(".commodity-status").hide():"yes"==isSold?(a=3,$(".commodity-status").hide()):"no"==isSold&&(a=0,$(".commodity-status").show()),$(".brand-picture img").attr("src",r),$(".brand-name").html(o+"."+s+" "+i)}}catch(e){$(".picture").hide(),$(".consumer-agency").hide(),$(".background").hide(),$("#consumer-content").hide(),$(".footer").hide(),$("body").css("background","#F8F8F8"),$(".loadEffect").hide().siblings(".middle").show(),$(".middle img").attr("src","images/vrf_wrong.png"),$(".middle p").html("请先扫描商品上的防伪标签再进行相应的登记操作哟!"),$(".loading").show()}},error:function(e,t,r){"timeout"==t&&($(".picture").hide(),$(".consumer-agency").hide(),$(".background").hide(),$("#consumer-content").hide(),$(".footer").hide(),$(".loadEffect").hide().siblings(".middle").show(),$(".loading").show())}})}function o(e,t){$(e).css({color:"#404040",background:"#fff"}),$(t).css({"border-top":"none",background:"#fff"})}function i(e,t){$(e).css({color:"red",background:"#fee1e5"}),$(t).css({"border-top":"2px solid #fee1e5",background:"#fee1e5"})}function s(){$(".top").css({position:"fixed"}),setTimeout(function(){var e=$(window).scrollTop();$(window).scrollTop(e)},1e3/60)}var n="https://h5.wpwl.org",d=function(){var e=location.search,t=new Object;if(-1!=e.indexOf("?")){var r=e.substr(1);t=/^(\d+)/.exec(r)[1]}return t}(),a=0;!function(e){$.ajax({url:n+"/wpwl/getKey?clientType=5",type:"POST",success:function(t){e&&e(t.data),console.log(t)}})}(function(e){r(e)}),$("#wpReload").click(function(){r(keyCode),window.location.reload()}),$(".finish-install").click(function(){a=3,$(this).css({background:"#4e9cfc",color:"#fff"}),$(".no-install-require").css({background:"#f2f2f2",color:"#bdbdbd"})}),$(".no-install-require").click(function(){a=4,$(this).css({background:"#4e9cfc",color:"#fff"}),$(".finish-install").css({background:"#f2f2f2",color:"#bdbdbd"})}),/(iPhone|iPad|iPod|iOS)/i.test(navigator.userAgent)&&$(".commodity-list").on("focus","input",function(){$(".top").css({position:"absolute"})});var c,u=function(e){this.context=null==e.context?$("body"):e.context,this.message=e.message,this.time=null==e.time?3e3:e.time,this.left=e.left,this.top=e.top,this.init()};u.prototype={init:function(){$("#toastMessage").remove();var e=new Array;e.push('<div id="toastMessage">'),e.push("<span>"+this.message+"</span>"),e.push("</div>"),c=$(e.join("")).appendTo(this.context);var t=null==this.left?this.context.width()/2-c.find("span").width()/2-20:this.left,r=null==this.bottom?"20px":this.bottom;c.css({position:"absolute",bottom:r,"z-index":"99",left:t,"background-color":"black",color:"white","font-size":"12px",padding:"10px",margin:"10px"})},show:function(){c.fadeIn(this.time/2),c.fadeOut(this.time/2)}},$("#get").click(function(){""!=$("#writeNumber").val()&&reg.test($("#writeNumber").val())&&(this.flag||(_t=this,e(function(e){$.ajax({url:n+"/wpservice/device/getDeviceCaptcha",type:"POST",data:{mobile:t($("#writeNumber").val(),e)},success:function(e){}}),_t.flag=!0;var r=60;_t.innerHTML="60秒";var o=setInterval(function(){_t.innerHTML=--r+"秒",0==r&&(clearInterval(o),_t.innerHTML="获取验证码",_t.flag=!1,$("#get").css({color:"#ff7a11"}))},1e3)}),$("#get").css({color:"#404040"}))),s()}),window.pattern=new RegExp("[`~!@#$^&*()=|{}':;',\\[\\].<>/?~！@#￥……&*（）|{}【】‘；：”“'。，、？]"),window.nameReg=/[\u4e00-\u9fa5a-zA-Z0-9]+$/,window.numReg=/\d+$/,window.numberReg=/^\d+$/,window.reg=/^1[3|4|5|7|8][0-9]{9}$/,window.userErr={},window.agencyErr={},$("#writeName").on("blur",function(e){var t=$("#writeName").val();$("#writeName").attr("realVal",t);var r="writeName";t.length>0&&t.length<=5&&!numReg.test(t)&&nameReg.test(t)&&!pattern.test(t)?(o("#writeName",".name"),r=""):""==t?($("#writeName").val("姓名不能为空"),i("#writeName",".name")):pattern.test(t)?(new u({context:$("body"),message:"含有非法字符或长度大于5"}).show(),i("#writeName",".name")):numReg.test(t)?(new u({context:$("body"),message:"含有数字或长度大于5"}).show(),i("#writeName",".name")):(new u({context:$("body"),message:"姓名至多5个字"}).show(),i("#writeName",".name")),userErr.writeName=r,s()}),$("#writeName").focus(function(){o("#writeName",".name"),$("#writeName").val($("#writeName").attr("realVal")),"姓名不能为空"==$("#writeName").val()&&$("#writeName").val("")}),$("#writeNumber").on("blur",function(e){var t=$("#writeNumber").val();$("#writeNumber").attr("realVal",t);var r="writeNumber";reg.test(t)?(o("#writeNumber",".phonenumber"),r=""):""==t?($("#writeNumber").val("手机号不能为空"),i("#writeNumber",".phonenumber")):(new u({context:$("body"),message:"请填写正确的手机号"}).show(),i("#writeNumber",".phonenumber")),userErr.writeNumber=r,s()}),$("#writeNumber").focus(function(){o("#writeNumber",".phonenumber"),$("#writeNumber").val($("#writeNumber").attr("realVal")),"手机号不能为空"==$("#writeNumber").val()&&$("#writeNumber").val("")}),$("#writeCode").blur(function(){var e="writeCode";$("#writeCode").val().length>6?new u({context:$("body"),message:"长度大于6"}).show():e="",userErr.writeCode=e}),$("#writeAddress").on("blur",function(e){var t=$("#writeAddress").val();$("#writeAddress").attr("realVal",t);var r="writeAddress";t.length>0&&t.length<=30&&!pattern.test(t)?(o("#writeAddress",".address"),r=""):""==t?($("#writeAddress").val(""),o("#writeAddress",".address"),r=""):pattern.test(t)?(new u({context:$("body"),message:"含有非法字符或长度大于5"}).show(),i("#writeAddress",".address")):(new u({context:$("body"),message:"住址至多30个字"}).show(),i("#writeAddress",".address")),userErr.writeAddress=r,s()}),$("#writeAddress").focus(function(){o("#writeAddress",".address"),$("#writeAddress").val($("#writeAddress").attr("realVal"))}),$("#writeProduct").on("blur",function(e){var t=$("#writeProduct").val();$("#writeProduct").attr("realVal",t);var r="writeProduct";t.length>0&&t.length<=50&&!pattern.test(t)?(o("#writeProduct",".product-model"),r=""):""==t?($("#writeProduct").val(""),o("#writeProduct",".product-model"),r=""):pattern.test(t)?(new u({context:$("body"),message:"含有非法字符"}).show(),i("#writeProduct",".product-model")):(new u({context:$("body"),message:"产品型号至多50个字"}).show(),i("#writeProduct",".product-model")),userErr.writeProduct=r,s()}),$("#writeProduct").focus(function(){o("#writeProduct",".product-model"),$("#writeProduct").val($("#writeProduct").attr("realVal"))}),$("#writeNum").on("blur",function(e){var t=$("#writeNum").val();$("#writeNum").attr("realVal",t);var r="writeNum";t.length>0&&t.length<=4&&numberReg.test(t)?(o("#writeNum",".number"),r=""):""==t?($("#writeNum").val(""),o("#writeNum",".number"),r=""):(new u({context:$("body"),message:"购买数量至多4个或只能输入数字"}).show(),i("#writeNum",".number")),userErr.writeNum=r,s()}),$("#writeNum").focus(function(){o("#writeNum",".number"),$("#writeNum").val($("#writeNum").attr("realVal"))}),$("#writeMore").on("blur",function(e){var t=$("#writeMore").val();$("#writeMore").attr("realVal",t);var r="writeMore";t.length>0&&t.length<=200&&!pattern.test(t)?(o("#writeMore",".remark"),r=""):""==t?($("#writeMore").val(""),o("#writeMore",".remark"),r=""):pattern.test(t)?(new u({context:$("body"),message:"含有非法字符或长度大于200"}).show(),i("#writeMore",".remark")):(new u({context:$("body"),message:"备注至多200个字"}).show(),i("#writeMore",".remark")),userErr.writeMore=r,s()}),$("#writeMore").focus(function(){o("#writeMore",".remark"),$("#writeMore").val($("#writeMore").attr("realVal"))}),$(".submit").click(function(){if(3!==a&&4!==a&&84!=orgId)new u({context:$("body"),message:"商品状态不能为空"}).show();else if(!$(this).hasClass("disabled")){$("#writeName").blur(),$("#writeNumber").blur(),$("#writeAddress").blur(),$("#writeProduct").blur(),$("#writeNum").blur(),$("#writeMore").blur(),$("#writeCode").blur();var r=!1;for(var o in userErr)userErr[o]&&(r=!0);if(r){new u({context:$("body"),message:"数据有误"}).show();for(var o in userErr)userErr[o]=""}else{var i=$(this);$(this).addClass("disabled");var d={};window.type="",84==orgId?"no"==isSold&&(type="1"):"yes"==isSold?type="0":"no"==isSold&&(4==a?type="1":3==a&&(type="2")),e(function(e){$("#consumer-content:visible").length&&(d={labelCode:t(labelCode,e),consumerName:t($("#writeName").val(),e),consumerMobile:t($("#writeNumber").val(),e),consumerAddress:t($("#writeAddress").val(),e),captcha:t($("#writeCode").val(),e),standard:t($("#writeProduct").val(),e),quantity:t($("#writeNum").val(),e),remark:t($("#writeMore").val(),e),type:t(type,e)}),$.ajax({type:"POST",url:n+"/wpservice/device/install29",async:!0,data:d,timeout:1e4,success:function(e){if(i.removeClass("disabled"),e.success)84==orgId?"yes"==isSold?($(".picture").hide(),$(".consumer-agency").hide(),$(".background").hide(),$("#consumer-content").hide(),$(".commodity-status").hide(),$(".footer").hide(),$("body").css("background","#F8F8F8"),$(".loadEffect").hide().siblings(".middle").show(),$(".middle img").attr("src","images/commodityRepetition.png"),$(".middle p").html("该商品已登记，请勿重复操作"),$(".loading").show()):($(".picture").hide(),$(".consumer-agency").hide(),$(".background").hide(),$("#consumer-content").hide(),$(".commodity-status").hide(),$(".footer").hide(),$("body").css("background","#F8F8F8"),$(".loadEffect").hide().siblings(".middle").show(),$(".middle img").attr("src","images/enterSuccess.png"),$(".middle p").html("登记成功"),$(".loading").show()):84!==orgId&&($(".picture").hide(),$(".consumer-agency").hide(),$(".background").hide(),$("#consumer-content").hide(),$(".commodity-status").hide(),$(".footer").hide(),$("body").css("background","#F8F8F8"),$(".loadEffect").hide().siblings(".middle").show(),$(".middle img").attr("src","images/enterSuccess.png"),$(".middle p").html("登记成功"),$(".loading").show());else{var t=e.errMsg;new u({context:$("body"),message:t}).show()}},error:function(e,t,r){"timeout"==t&&new u({context:$("body"),message:"网络超时"}).show(),i.removeClass("disabled")}})}),s()}}})});